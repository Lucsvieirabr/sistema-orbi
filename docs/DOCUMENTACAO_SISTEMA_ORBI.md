# üìö Documenta√ß√£o Completa - Sistema Orbi

## üìã √çndice

1. [Vis√£o Geral](#vis√£o-geral)
2. [Tecnologias Utilizadas](#tecnologias-utilizadas)
3. [Arquitetura do Sistema](#arquitetura-do-sistema)
4. [Estrutura de Banco de Dados](#estrutura-de-banco-de-dados)
5. [Rotas e Navega√ß√£o](#rotas-e-navega√ß√£o)
6. [Funcionalidades Principais](#funcionalidades-principais)
7. [Sistema SaaS](#sistema-saas)
8. [Edge Functions](#edge-functions)
9. [Hooks Customizados](#hooks-customizados)
10. [Componentes Principais](#componentes-principais)
11. [Autentica√ß√£o e Seguran√ßa](#autentica√ß√£o-e-seguran√ßa)
12. [Configura√ß√£o e Deploy](#configura√ß√£o-e-deploy)
13. [Estrutura de Pastas](#estrutura-de-pastas)

---

## üéØ Vis√£o Geral

O **Sistema Orbi** √© uma plataforma SaaS completa de gest√£o financeira pessoal e empresarial desenvolvida em React com TypeScript. O sistema oferece controle de contas, transa√ß√µes, cart√µes de cr√©dito, categoriza√ß√£o inteligente com Machine Learning, relat√≥rios avan√ßados e muito mais.

### Principais Caracter√≠sticas

- üí≥ Gest√£o completa de contas banc√°rias e cart√µes de cr√©dito
- ü§ñ Classifica√ß√£o inteligente de transa√ß√µes com Machine Learning
- üìä Dashboard com m√©tricas e gr√°ficos em tempo real
- üîÑ Controle de parcelamentos e transa√ß√µes recorrentes
- üë• Gest√£o de pessoas e transa√ß√µes compartilhadas
- üìà Relat√≥rios mensais detalhados
- üè¢ Sistema SaaS multi-tenant com planos de assinatura
- üí∞ Integra√ß√£o com gateway de pagamentos Asaas
- üîê Painel administrativo completo
- üåì Tema claro/escuro
- üì± Interface responsiva

---

## üõ†Ô∏è Tecnologias Utilizadas

### Frontend

| Tecnologia | Vers√£o | Descri√ß√£o |
|------------|--------|-----------|
| **React** | 18.3.1 | Biblioteca para constru√ß√£o de interfaces |
| **TypeScript** | 5.8.3 | Superset JavaScript com tipagem est√°tica |
| **Vite** | 5.4.19 | Build tool e dev server ultra-r√°pido |
| **React Router** | 6.30.1 | Roteamento de aplica√ß√µes React |
| **TanStack Query** | 5.83.0 | Gerenciamento de estado ass√≠ncrono |
| **Tailwind CSS** | 3.4.17 | Framework CSS utility-first |
| **shadcn/ui** | - | Componentes UI com Radix UI |
| **Lucide React** | 0.544.0 | Biblioteca de √≠cones |
| **Recharts** | 2.15.4 | Biblioteca de gr√°ficos para React |
| **date-fns** | 3.6.0 | Manipula√ß√£o de datas |
| **zod** | 3.25.76 | Valida√ß√£o de schemas |
| **react-hook-form** | 7.61.1 | Gerenciamento de formul√°rios |
| **PapaParse** | 5.5.3 | Parser de CSV |

### Backend

| Tecnologia | Descri√ß√£o |
|------------|-----------|
| **Supabase** | Backend-as-a-Service (PostgreSQL + Auth + Storage) |
| **PostgreSQL** | Banco de dados relacional |
| **Deno** | Runtime para Edge Functions |
| **Row Level Security (RLS)** | Seguran√ßa a n√≠vel de linha no PostgreSQL |

### Infraestrutura e Deploy

| Tecnologia | Descri√ß√£o |
|------------|-----------|
| **Netlify** | Deploy e hospedagem do frontend |
| **Supabase Cloud** | Hospedagem do backend |
| **Nginx** | Servidor web (configura√ß√£o inclu√≠da) |

### Integra√ß√µes Externas

| Servi√ßo | Uso |
|---------|-----|
| **Asaas** | Gateway de pagamentos (PIX, Boleto, Cart√£o) |

---

## üèóÔ∏è Arquitetura do Sistema

### Vis√£o Geral da Arquitetura

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    FRONTEND (React)                      ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ   Public    ‚îÇ  ‚îÇ    User      ‚îÇ  ‚îÇ    Admin     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ   Routes    ‚îÇ  ‚îÇ   Routes     ‚îÇ  ‚îÇ   Routes     ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                         ‚îÇ HTTPS / REST API
                         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                SUPABASE (Backend)                        ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ   Auth   ‚îÇ  ‚îÇ   API    ‚îÇ  ‚îÇ   Edge Functions     ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ Database ‚îÇ  ‚îÇ Storage  ‚îÇ  ‚îÇ   Realtime (WS)      ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                         ‚îÇ Webhooks
                         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              ASAAS (Pagamentos)                          ‚îÇ
‚îÇ     PIX ‚îÇ Boleto ‚îÇ Cart√£o de Cr√©dito                    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Fluxo de Dados

1. **Autentica√ß√£o**: Usu√°rio faz login via Supabase Auth
2. **Autoriza√ß√£o**: RLS valida permiss√µes no PostgreSQL
3. **Estado**: TanStack Query gerencia cache e sincroniza√ß√£o
4. **Realtime**: Updates autom√°ticos via WebSocket
5. **Pagamentos**: Edge Functions comunicam com Asaas
6. **Storage**: Logos e imagens no Supabase Storage

### Padr√µes de Design

- **Component-Based Architecture**: Componentes reutiliz√°veis
- **Custom Hooks**: L√≥gica de neg√≥cio encapsulada
- **Layouts**: Layouts compartilhados para diferentes √°reas
- **Guards**: Prote√ß√£o de rotas baseada em permiss√µes
- **API Layer**: Abstra√ß√£o com Supabase Client

---

## üóÑÔ∏è Estrutura de Banco de Dados

### Principais Tabelas

#### Tabelas de Usu√°rios

**`user_profiles`**
```sql
- id (UUID, PK)
- email (TEXT)
- full_name (TEXT)
- avatar_url (TEXT)
- asaas_customer_id (TEXT) -- ID no gateway de pagamento
- created_at (TIMESTAMP)
- updated_at (TIMESTAMP)
```

**`admin_users`**
```sql
- id (UUID, PK)
- user_id (UUID, FK -> auth.users)
- role (TEXT) -- 'super_admin', 'admin', 'support'
- is_active (BOOLEAN)
- permissions (JSONB)
- created_at (TIMESTAMP)
```

#### Tabelas Financeiras

**`accounts`** - Contas banc√°rias
```sql
- id (UUID, PK)
- user_id (UUID, FK)
- name (TEXT)
- type (TEXT) -- 'corrente', 'poupanca', 'investimento'
- initial_balance (DECIMAL)
- color (TEXT)
- created_at (TIMESTAMP)
```

**`transactions`** - Transa√ß√µes financeiras
```sql
- id (UUID, PK)
- user_id (UUID, FK)
- account_id (UUID, FK)
- category_id (UUID, FK)
- series_id (UUID, FK) -- Para parcelamentos
- person_id (UUID, FK) -- Pessoa relacionada
- description (TEXT)
- value (DECIMAL)
- date (DATE)
- type (TEXT) -- 'income', 'expense'
- status (TEXT) -- 'pending', 'confirmed', 'canceled'
- is_fixed (BOOLEAN) -- Transa√ß√£o recorrente
- is_shared (BOOLEAN) -- Transa√ß√£o compartilhada
- installment_number (INTEGER)
- composition_details (JSONB)
- logo_url (TEXT)
- created_at (TIMESTAMP)
- updated_at (TIMESTAMP)
```

**`credit_cards`** - Cart√µes de cr√©dito
```sql
- id (UUID, PK)
- user_id (UUID, FK)
- name (TEXT)
- brand (TEXT) -- 'visa', 'mastercard', 'elo'
- limit (DECIMAL)
- statement_date (INTEGER) -- Dia fechamento
- due_date (INTEGER) -- Dia vencimento
- connected_account_id (UUID, FK) -- Conta vinculada
- created_at (TIMESTAMP)
```

**`categories`** - Categorias de transa√ß√µes
```sql
- id (UUID, PK)
- user_id (UUID, FK) -- NULL para categorias globais
- name (TEXT)
- icon (TEXT)
- category_type (TEXT) -- 'income', 'expense'
- is_system (BOOLEAN) -- Categoria do sistema
- created_at (TIMESTAMP)
```

**`series`** - S√©ries de parcelamentos
```sql
- id (UUID, PK)
- user_id (UUID, FK)
- description (TEXT)
- total_installments (INTEGER)
- total_value (DECIMAL)
- category_id (UUID, FK)
- is_recurring (BOOLEAN)
- recurrence_type (TEXT) -- 'monthly', 'weekly'
- logo_url (TEXT)
- created_at (TIMESTAMP)
```

**`people`** - Pessoas relacionadas
```sql
- id (UUID, PK)
- user_id (UUID, FK)
- name (TEXT)
- email (TEXT)
- phone (TEXT)
- cpf_cnpj (TEXT)
- pix_key (TEXT)
- notes (TEXT)
- created_at (TIMESTAMP)
```

#### Tabelas SaaS

**`subscription_plans`** - Planos de assinatura
```sql
- id (UUID, PK)
- name (TEXT) -- 'Free', 'Pro', 'Premium'
- slug (TEXT, UNIQUE)
- description (TEXT)
- monthly_price (DECIMAL)
- annual_price (DECIMAL)
- features (TEXT[])
- limits (JSONB)
- is_active (BOOLEAN)
- created_at (TIMESTAMP)
```

**`user_subscriptions`** - Assinaturas dos usu√°rios
```sql
- id (UUID, PK)
- user_id (UUID, FK)
- plan_id (UUID, FK)
- status (TEXT) -- 'trial', 'active', 'past_due', 'canceled'
- billing_cycle (TEXT) -- 'monthly', 'annual'
- current_period_start (DATE)
- current_period_end (DATE)
- asaas_subscription_id (TEXT)
- created_at (TIMESTAMP)
```

**`payment_history`** - Hist√≥rico de pagamentos
```sql
- id (UUID, PK)
- user_id (UUID, FK)
- subscription_id (UUID, FK)
- asaas_payment_id (TEXT)
- amount (DECIMAL)
- status (TEXT) -- 'pending', 'confirmed', 'failed'
- payment_method (TEXT) -- 'PIX', 'BOLETO', 'CREDIT_CARD'
- invoice_url (TEXT)
- bank_slip_url (TEXT)
- pix_qr_code (TEXT)
- pix_copy_paste (TEXT)
- paid_at (TIMESTAMP)
- created_at (TIMESTAMP)
```

#### Tabelas de ML e Cache

**`learned_patterns`** - Padr√µes aprendidos por ML
```sql
- id (UUID, PK)
- user_id (UUID, FK)
- normalized_merchant (TEXT)
- category_id (UUID, FK)
- confidence (DECIMAL)
- usage_count (INTEGER)
- last_used_at (TIMESTAMP)
```

**`merchants_dictionary`** - Dicion√°rio de comerciantes
```sql
- id (UUID, PK)
- original_name (TEXT)
- normalized_name (TEXT)
- category_id (UUID, FK)
- confidence (DECIMAL)
```

**`keyword_patterns`** - Padr√µes de palavras-chave
```sql
- id (UUID, PK)
- keyword (TEXT)
- category_id (UUID, FK)
- weight (DECIMAL)
- context (TEXT)
```

#### Outras Tabelas

**`notes`** - Notas/Anota√ß√µes
```sql
- id (UUID, PK)
- user_id (UUID, FK)
- title (TEXT)
- content (TEXT)
- color (TEXT)
- created_at (TIMESTAMP)
- updated_at (TIMESTAMP)
```

**`bug_reports`** - Relat√≥rios de bugs
```sql
- id (UUID, PK)
- user_id (UUID, FK)
- title (TEXT)
- description (TEXT)
- severity (TEXT) -- 'low', 'medium', 'high', 'critical'
- status (TEXT) -- 'open', 'in_progress', 'resolved'
- created_at (TIMESTAMP)
```

**`audit_logs`** - Logs de auditoria
```sql
- id (UUID, PK)
- user_id (UUID, FK)
- entity_type (TEXT)
- entity_id (UUID)
- action (TEXT) -- 'create', 'update', 'delete'
- old_data (JSONB)
- new_data (JSONB)
- metadata (JSONB)
- created_at (TIMESTAMP)
```

### Views Importantes

**`vw_account_current_balance`** - Saldo atual das contas
```sql
SELECT account_id, SUM(value) as current_balance
FROM transactions
WHERE status = 'confirmed'
GROUP BY account_id
```

### Fun√ß√µes SQL Importantes

- `is_admin()` - Verifica se usu√°rio √© admin
- `get_user_plan()` - Retorna plano do usu√°rio
- `user_has_feature(feature)` - Verifica se usu√°rio tem feature
- `admin_list_users()` - Lista usu√°rios (apenas admin)
- `create_installment_series()` - Cria s√©rie de parcelamentos
- `update_transaction_series()` - Atualiza s√©rie de transa√ß√µes
- `search_merchant()` - Busca comerciante no dicion√°rio

### Row Level Security (RLS)

Todas as tabelas t√™m pol√≠ticas RLS configuradas:

```sql
-- Exemplo: Usu√°rios s√≥ veem seus pr√≥prios dados
CREATE POLICY "Users can view own data"
  ON transactions FOR SELECT
  USING (auth.uid() = user_id);

-- Admins veem tudo
CREATE POLICY "Admins can view all"
  ON transactions FOR SELECT
  USING (is_admin());
```

---

## üó∫Ô∏è Rotas e Navega√ß√£o

### Estrutura de Rotas

```typescript
/ (root)
‚îú‚îÄ‚îÄ /pricing                    [P√∫blico] P√°gina de planos
‚îú‚îÄ‚îÄ /login                      [P√∫blico] Login de usu√°rios
‚îú‚îÄ‚îÄ /admin                      [P√∫blico] Login administrativo
‚îÇ
‚îú‚îÄ‚îÄ /sistema                    [Protegido] √Årea do usu√°rio
‚îÇ   ‚îú‚îÄ‚îÄ / (index)              ‚Üí Dashboard
‚îÇ   ‚îú‚îÄ‚îÄ /statement             ‚Üí Extrato Mensal
‚îÇ   ‚îú‚îÄ‚îÄ /categories            ‚Üí Gest√£o de Categorias
‚îÇ   ‚îú‚îÄ‚îÄ /accounts              ‚Üí Gest√£o de Contas
‚îÇ   ‚îú‚îÄ‚îÄ /cards                 ‚Üí Gest√£o de Cart√µes
‚îÇ   ‚îú‚îÄ‚îÄ /cards/:id/statements  ‚Üí Fatura do Cart√£o
‚îÇ   ‚îú‚îÄ‚îÄ /people                ‚Üí Gest√£o de Pessoas
‚îÇ   ‚îú‚îÄ‚îÄ /people/:id            ‚Üí Detalhes da Pessoa
‚îÇ   ‚îú‚îÄ‚îÄ /my-ai                 ‚Üí IA - Classifica√ß√£o ML
‚îÇ   ‚îú‚îÄ‚îÄ /notes                 ‚Üí Notas/Anota√ß√µes
‚îÇ   ‚îî‚îÄ‚îÄ /settings              ‚Üí Configura√ß√µes
‚îÇ
‚îî‚îÄ‚îÄ /admin                      [Protegido Admin] Painel Admin
    ‚îú‚îÄ‚îÄ /dashboard             ‚Üí Dashboard Admin
    ‚îú‚îÄ‚îÄ /users                 ‚Üí Gest√£o de Usu√°rios
    ‚îú‚îÄ‚îÄ /plans                 ‚Üí Gest√£o de Planos
    ‚îú‚îÄ‚îÄ /subscriptions         ‚Üí Gest√£o de Assinaturas
    ‚îú‚îÄ‚îÄ /admins                ‚Üí Gest√£o de Admins
    ‚îî‚îÄ‚îÄ /bug-reports           ‚Üí Relat√≥rios de Bugs
```

### Fluxo de Autentica√ß√£o

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Usu√°rio   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ N√£o autenticado ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ /pricing ou /login
       ‚îÇ
       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ Autenticado
                    ‚îÇ
                    ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ Sem assinatura ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ /pricing
                    ‚îÇ
                    ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ Com assinatura ativa ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ /sistema
                    ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ √â admin ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ /admin/*
```

### Componentes de Layout

#### `AppLayout`
Layout principal para usu√°rios autenticados:
- Header com busca global
- Sidebar com navega√ß√£o
- Outlet para conte√∫do din√¢mico

#### `AdminLayout`
Layout para painel administrativo:
- Header admin
- Sidebar admin
- Outlet para p√°ginas admin

---

## ‚öôÔ∏è Funcionalidades Principais

### 1. Dashboard

**P√°gina**: `/sistema`

Caracter√≠sticas:
- ‚úÖ Saldo total de todas as contas
- ‚úÖ Gr√°fico de evolu√ß√£o mensal
- ‚úÖ Resumo de receitas e despesas
- ‚úÖ Transa√ß√µes recentes
- ‚úÖ Alertas de vencimentos
- ‚úÖ M√©tricas de cart√µes de cr√©dito

### 2. Extrato Mensal

**P√°gina**: `/sistema/statement`

Caracter√≠sticas:
- ‚úÖ Visualiza√ß√£o mensal de transa√ß√µes
- ‚úÖ Filtros por conta, categoria, pessoa
- ‚úÖ Adicionar/Editar/Excluir transa√ß√µes
- ‚úÖ Marcar como pago/pendente
- ‚úÖ Parcelamento de transa√ß√µes
- ‚úÖ Transa√ß√µes compartilhadas
- ‚úÖ Upload de CSV banc√°rio
- ‚úÖ Classifica√ß√£o autom√°tica com ML
- ‚úÖ Exporta√ß√£o de relat√≥rios

**Upload de Extrato (CSV)**:
- Parser inteligente de CSV
- Detec√ß√£o autom√°tica de bancos
- Normaliza√ß√£o de descri√ß√µes
- Cache de classifica√ß√µes
- Machine Learning para categoriza√ß√£o

### 3. Gest√£o de Categorias

**P√°gina**: `/sistema/categories`

Caracter√≠sticas:
- ‚úÖ Categorias de receita e despesa
- ‚úÖ √çcones personaliz√°veis
- ‚úÖ Categorias do sistema (n√£o edit√°veis)
- ‚úÖ Categorias customizadas por usu√°rio
- ‚úÖ Estat√≠sticas de uso

### 4. Gest√£o de Contas

**P√°gina**: `/sistema/accounts`

Caracter√≠sticas:
- ‚úÖ Criar m√∫ltiplas contas
- ‚úÖ Tipos: Corrente, Poupan√ßa, Investimento
- ‚úÖ Saldo inicial configur√°vel
- ‚úÖ Cores personalizadas
- ‚úÖ C√°lculo autom√°tico de saldo atual
- ‚úÖ Hist√≥rico de transa√ß√µes

### 5. Gest√£o de Cart√µes de Cr√©dito

**P√°gina**: `/sistema/cards`

Caracter√≠sticas:
- ‚úÖ Cadastro de m√∫ltiplos cart√µes
- ‚úÖ Limite, data de fechamento e vencimento
- ‚úÖ Vincula√ß√£o com conta banc√°ria
- ‚úÖ Faturas mensais
- ‚úÖ Controle de limite dispon√≠vel
- ‚úÖ Parcelamentos

**Fatura do Cart√£o**: `/sistema/cards/:id/statements`
- Transa√ß√µes do per√≠odo
- Total da fatura
- Pagamento da fatura
- Exporta√ß√£o

### 6. Gest√£o de Pessoas

**P√°gina**: `/sistema/people`

Caracter√≠sticas:
- ‚úÖ Cadastro de pessoas f√≠sicas/jur√≠dicas
- ‚úÖ CPF/CNPJ, email, telefone
- ‚úÖ Chave PIX
- ‚úÖ Notas sobre a pessoa
- ‚úÖ Transa√ß√µes relacionadas
- ‚úÖ D√©bitos e cr√©ditos

**Detalhes da Pessoa**: `/sistema/people/:id`
- Hist√≥rico completo de transa√ß√µes
- Saldo devedor/credor
- Gr√°ficos de movimenta√ß√£o

### 7. My AI - Classifica√ß√£o Inteligente

**P√°gina**: `/sistema/my-ai`

Caracter√≠sticas:
- ‚úÖ Machine Learning para classifica√ß√£o
- ‚úÖ Padr√µes aprendidos
- ‚úÖ Cache inteligente
- ‚úÖ Dicion√°rio de comerciantes
- ‚úÖ An√°lise de palavras-chave
- ‚úÖ Treinamento do modelo
- ‚úÖ Hist√≥rico de acertos

**Algoritmo de ML**:
```
1. Normaliza descri√ß√£o da transa√ß√£o
2. Busca em cache de padr√µes aprendidos
3. Consulta dicion√°rio de comerciantes
4. Analisa palavras-chave com pesos
5. Aplica confian√ßa baseada em uso
6. Retorna categoria sugerida
7. Aprende com confirma√ß√µes do usu√°rio
```

### 8. Notas

**P√°gina**: `/sistema/notes`

Caracter√≠sticas:
- ‚úÖ Cria√ß√£o de notas
- ‚úÖ Cores personalizadas
- ‚úÖ Editor de texto
- ‚úÖ Busca de notas
- ‚úÖ Organiza√ß√£o por data

### 9. Configura√ß√µes

**P√°gina**: `/sistema/settings`

Caracter√≠sticas:
- ‚úÖ Perfil do usu√°rio
- ‚úÖ Tema claro/escuro
- ‚úÖ Notifica√ß√µes
- ‚úÖ Prefer√™ncias
- ‚úÖ Dados da assinatura
- ‚úÖ Hist√≥rico de pagamentos

---

## üíº Sistema SaaS

### Arquitetura Multi-Tenant

O sistema implementa SaaS com:
- ‚úÖ M√∫ltiplos planos de assinatura
- ‚úÖ Isolamento de dados por usu√°rio (RLS)
- ‚úÖ Controle de features por plano
- ‚úÖ Limites por plano
- ‚úÖ Billing e pagamentos
- ‚úÖ Painel administrativo

### Planos de Assinatura

#### **Free**
```
Pre√ßo: R$ 0,00
Features:
- ‚úÖ Dashboard b√°sico
- ‚úÖ Categoriza√ß√£o manual
- ‚úÖ 2 contas
- ‚úÖ 1 cart√£o de cr√©dito
- ‚úÖ 100 transa√ß√µes/m√™s
- ‚úÖ 3 pessoas
- ‚úÖ Reten√ß√£o: 6 meses
```

#### **Pro**
```
Pre√ßo: R$ 29,90/m√™s ou R$ 299,00/ano
Features:
- ‚úÖ Todas do Free
- ‚úÖ Classifica√ß√£o ML
- ‚úÖ Relat√≥rios avan√ßados
- ‚úÖ Exporta√ß√£o CSV
- ‚úÖ Logos customizados
- ‚úÖ Categorias customizadas
- ‚úÖ Upload em massa
- ‚úÖ Suporte priorit√°rio
- ‚úÖ 10 contas
- ‚úÖ 5 cart√µes
- ‚úÖ 1000 transa√ß√µes/m√™s
- ‚úÖ 10 pessoas
- ‚úÖ Reten√ß√£o: 24 meses
```

#### **Premium**
```
Pre√ßo: R$ 59,90/m√™s ou R$ 599,00/ano
Features:
- ‚úÖ Todas do Pro
- ‚úÖ Recursos ilimitados
- ‚úÖ API access
- ‚úÖ White-label
- ‚úÖ Suporte dedicado
- ‚úÖ Relat√≥rios personalizados
```

### Controle de Features

**Hook `useSubscription`**:
```typescript
const { 
  subscription,     // Dados da assinatura
  plan,            // Dados do plano
  hasFeature,      // Verifica se tem feature
  checkLimit,      // Verifica limite
  isPro,           // √â plano Pro?
  isPremium        // √â plano Premium?
} = useSubscription();

// Verificar feature
if (!hasFeature('ml_classification')) {
  return <UpgradePrompt />;
}

// Verificar limite
if (!checkLimit('max_accounts', currentCount)) {
  return <LimitReached />;
}
```

### Features Dispon√≠veis

```typescript
const FEATURES = {
  // B√°sicas
  basic_dashboard: 'Dashboard B√°sico',
  manual_categorization: 'Categoriza√ß√£o Manual',
  
  // Pro
  csv_export: 'Exporta√ß√£o CSV',
  ml_classification: 'Classifica√ß√£o ML',
  advanced_reports: 'Relat√≥rios Avan√ßados',
  priority_support: 'Suporte Priorit√°rio',
  logo_customization: 'Logos Personalizados',
  custom_categories: 'Categorias Customizadas',
  bulk_import: 'Importa√ß√£o em Massa',
  scheduled_reports: 'Relat√≥rios Agendados',
  
  // Premium
  api_access: 'Acesso √† API',
  white_label: 'White Label',
  dedicated_support: 'Suporte Dedicado',
  custom_integrations: 'Integra√ß√µes Customizadas'
};
```

### Limites por Plano

```typescript
const PLAN_LIMITS = {
  free: {
    max_accounts: 2,
    max_transactions_per_month: 100,
    max_credit_cards: 1,
    max_people: 3,
    retention_months: 6
  },
  pro: {
    max_accounts: 10,
    max_transactions_per_month: 1000,
    max_credit_cards: 5,
    max_people: 10,
    retention_months: 24
  },
  premium: {
    max_accounts: -1,  // Ilimitado
    max_transactions_per_month: -1,
    max_credit_cards: -1,
    max_people: -1,
    retention_months: -1
  }
};
```

### Integra√ß√£o com Asaas

**Gateway de Pagamentos**: Asaas

**M√©todos de Pagamento**:
- ‚úÖ PIX (instant√¢neo)
- ‚úÖ Boleto Banc√°rio
- ‚úÖ Cart√£o de Cr√©dito

**Fluxo de Pagamento**:

```
1. Usu√°rio escolhe plano em /pricing
2. Sistema cria customer no Asaas (se n√£o existir)
3. Gera cobran√ßa via Edge Function
4. Mostra dados de pagamento (PIX/Boleto)
5. Usu√°rio realiza pagamento
6. Asaas envia webhook
7. Sistema ativa assinatura
8. Usu√°rio recebe acesso
```

**Edge Functions de Pagamento**:
- `asaas-create-customer` - Cria customer
- `asaas-create-payment` - Cria cobran√ßa
- `asaas-webhook-handler` - Processa webhooks

### Painel Administrativo

**Acesso**: `/admin`

**Funcionalidades**:

1. **Dashboard** (`/admin/dashboard`)
   - Total de usu√°rios
   - Receita mensal
   - Convers√µes
   - M√©tricas gerais

2. **Gest√£o de Usu√°rios** (`/admin/users`)
   - Listar todos os usu√°rios
   - Editar plano do usu√°rio
   - Ativar/Desativar usu√°rios
   - Ver detalhes completos
   - Hist√≥rico de pagamentos

3. **Gest√£o de Planos** (`/admin/plans`)
   - CRUD de planos
   - Configurar features
   - Definir limites
   - Ativar/Desativar planos

4. **Gest√£o de Assinaturas** (`/admin/subscriptions`)
   - Todas as assinaturas
   - Filtros por status
   - Cancelar assinaturas
   - Renova√ß√µes

5. **Gest√£o de Admins** (`/admin/admins`)
   - Adicionar administradores
   - Definir permiss√µes
   - Ativar/Desativar

6. **Relat√≥rios de Bugs** (`/admin/bug-reports`)
   - Bugs reportados por usu√°rios
   - Prioridade e status
   - Responder e resolver

---

## üîß Edge Functions

### Localiza√ß√£o

`/supabase/functions/`

### Fun√ß√µes Dispon√≠veis

#### 1. `classify-transactions`

**Descri√ß√£o**: Classifica transa√ß√µes usando ML

**Entrada**:
```json
{
  "descriptions": ["UBER *EATS", "NETFLIX", "MERCADO LIVRE"]
}
```

**Sa√≠da**:
```json
{
  "classifications": [
    { "category": "Alimenta√ß√£o", "confidence": 0.95 },
    { "category": "Assinaturas", "confidence": 0.98 },
    { "category": "Compras Online", "confidence": 0.85 }
  ]
}
```

#### 2. `get-company-logo`

**Descri√ß√£o**: Busca logo de empresa

**Entrada**:
```json
{
  "companyName": "Netflix"
}
```

**Sa√≠da**:
```json
{
  "logoUrl": "https://..."
}
```

#### 3. `search-logo`

**Descri√ß√£o**: Busca logo com m√∫ltiplas fontes

**Entrada**:
```json
{
  "query": "uber eats"
}
```

**Sa√≠da**:
```json
{
  "logoUrl": "https://...",
  "source": "clearbit"
}
```

#### 4. `asaas-create-customer`

**Descri√ß√£o**: Cria customer no Asaas

**Entrada**:
```json
{
  "userId": "uuid",
  "userEmail": "email@example.com",
  "userName": "John Doe",
  "cpfCnpj": "12345678901",
  "phone": "11999999999"
}
```

**Sa√≠da**:
```json
{
  "success": true,
  "customerId": "cus_xxxxx"
}
```

#### 5. `asaas-create-payment`

**Descri√ß√£o**: Cria cobran√ßa no Asaas

**Entrada**:
```json
{
  "planId": "uuid",
  "billingCycle": "monthly",
  "paymentMethod": "PIX"
}
```

**Sa√≠da**:
```json
{
  "success": true,
  "payment": {
    "id": "pay_xxxxx",
    "value": 29.90,
    "dueDate": "2025-11-19",
    "invoiceUrl": "https://...",
    "pixQrCode": "https://...",
    "pixCopyPaste": "00020126..."
  }
}
```

#### 6. `asaas-webhook-handler`

**Descri√ß√£o**: Processa webhooks do Asaas

**Eventos Tratados**:
- `PAYMENT_CONFIRMED` - Ativa assinatura
- `PAYMENT_RECEIVED` - Registra pagamento
- `PAYMENT_OVERDUE` - Marca como vencido
- `PAYMENT_REFUNDED` - Processa reembolso
- `SUBSCRIPTION_CREATED` - Cria assinatura
- `SUBSCRIPTION_UPDATED` - Atualiza dados
- `SUBSCRIPTION_CANCELED` - Cancela assinatura

---

## üé£ Hooks Customizados

### Localiza√ß√£o

`/src/hooks/`

### Hooks Dispon√≠veis

#### Autentica√ß√£o

```typescript
// use-auth.ts
const { user, signIn, signUp, signOut, isLoading } = useAuth();

// use-admin-auth.ts
const { isAdmin, permissions } = useAdminAuth();
```

#### Dados Financeiros

```typescript
// use-accounts.ts
const { accounts, addAccount, updateAccount, deleteAccount } = useAccounts();

// use-transactions.ts
const { transactions, addTransaction, updateTransaction } = useMonthlyTransactions();

// use-credit-cards.ts
const { cards, addCard, updateCard, deleteCard } = useCreditCards();

// use-categories.ts
const { categories, addCategory, updateCategory } = useCategories();

// use-people.ts
const { people, addPerson, updatePerson, deletePerson } = usePeople();
```

#### SaaS

```typescript
// use-subscription.ts
const { 
  subscription, 
  plan, 
  hasFeature, 
  checkLimit,
  isLoading 
} = useSubscription();

// use-payment.ts
const { 
  createPayment, 
  paymentData, 
  isLoading 
} = usePayment();
```

#### ML e Cache

```typescript
// use-learned-patterns.ts
const { 
  patterns, 
  learnPattern, 
  getPatternForMerchant 
} = useLearnedPatterns();
```

#### UI

```typescript
// use-theme.tsx
const { theme, setTheme } = useTheme(); // 'light' | 'dark'

// use-mobile.tsx
const { isMobile } = useMobile();

// use-toast.ts
const { toast } = useToast();
```

---

## üß© Componentes Principais

### Componentes de Autentica√ß√£o

#### `AuthForm`
**Localiza√ß√£o**: `/src/components/auth/AuthForm.tsx`

Formul√°rio de login/cadastro com:
- ‚úÖ Login com email/senha
- ‚úÖ Cadastro de novos usu√°rios
- ‚úÖ Valida√ß√£o de formul√°rio
- ‚úÖ Estados de loading

#### `AdminAuthForm`
**Localiza√ß√£o**: `/src/admin/components/AdminAuthForm.tsx`

Formul√°rio de login administrativo com:
- ‚úÖ Visual diferenciado
- ‚úÖ Valida√ß√£o de permiss√µes admin
- ‚úÖ Redirecionamento espec√≠fico

### Componentes de Dashboard

#### `Dashboard`
**Localiza√ß√£o**: `/src/components/dashboard/Dashboard.tsx`

Dashboard principal com:
- ‚úÖ Cards de m√©tricas
- ‚úÖ Gr√°ficos de evolu√ß√£o
- ‚úÖ Transa√ß√µes recentes
- ‚úÖ Alertas e notifica√ß√µes

#### `SubscriptionChart`
**Localiza√ß√£o**: `/src/components/dashboard/SubscriptionChart.tsx`

Gr√°fico de assinaturas (admin):
- ‚úÖ Visualiza√ß√£o mensal
- ‚úÖ Compara√ß√£o de planos
- ‚úÖ M√©tricas de convers√£o

### Componentes de Extrato

#### `ExtratoUploader`
**Localiza√ß√£o**: `/src/components/extrato-uploader/ExtratoUploader.tsx`

Upload de CSV banc√°rio:
- ‚úÖ Drag and drop
- ‚úÖ Parser inteligente
- ‚úÖ Preview de dados
- ‚úÖ Classifica√ß√£o autom√°tica
- ‚úÖ Confirma√ß√£o antes de salvar

**Componentes Auxiliares**:
- `CSVParser.ts` - Parser b√°sico
- `EnhancedCSVParser.ts` - Parser avan√ßado
- `BatchClassifier.ts` - Classifica√ß√£o em lote
- `IntelligentTransactionClassifier.ts` - ML classifier
- `BankDictionary.ts` - Dicion√°rio de bancos
- `DescriptionNormalizer.ts` - Normaliza√ß√£o
- `IntelligentCache.ts` - Cache inteligente
- `MerchantCache.ts` - Cache de comerciantes
- `ConfirmationDialog.tsx` - Confirma√ß√£o de upload

### Componentes de Navega√ß√£o

#### `AppHeader`
**Localiza√ß√£o**: `/src/components/navigation/AppHeader.tsx`

Header principal:
- ‚úÖ Logo
- ‚úÖ Busca global
- ‚úÖ Notifica√ß√µes
- ‚úÖ Tema
- ‚úÖ Perfil do usu√°rio

#### `AppSidebar`
**Localiza√ß√£o**: `/src/components/navigation/AppSidebar.tsx`

Sidebar de navega√ß√£o:
- ‚úÖ Menu principal
- ‚úÖ √çcones Lucide
- ‚úÖ Indicador de rota ativa
- ‚úÖ Responsiva (mobile drawer)

#### `AdminSidebar`
**Localiza√ß√£o**: `/src/admin/components/AdminSidebar.tsx`

Sidebar administrativa:
- ‚úÖ Menu admin
- ‚úÖ Navega√ß√£o espec√≠fica

### Componentes de Pagamento

#### `PaymentDialog`
**Localiza√ß√£o**: `/src/components/payment/PaymentDialog.tsx`

Dialog de pagamento:
- ‚úÖ Exibi√ß√£o de dados da cobran√ßa
- ‚úÖ QR Code PIX
- ‚úÖ C√≥digo PIX copia e cola
- ‚úÖ Link para boleto
- ‚úÖ Link para fatura

### Guards

#### `SubscriptionGuard`
**Localiza√ß√£o**: `/src/components/guards/SubscriptionGuard.tsx`

Prote√ß√£o de rotas por assinatura:
- ‚úÖ Verifica se usu√°rio tem assinatura ativa
- ‚úÖ Redireciona para /pricing se n√£o tiver
- ‚úÖ Loading state

#### `FeatureGuard`
**Localiza√ß√£o**: `/src/components/guards/FeatureGuard.tsx`

Prote√ß√£o por feature:
```tsx
<FeatureGuard feature="ml_classification">
  <MLFeature />
</FeatureGuard>
```

### Componentes UI (shadcn/ui)

**Localiza√ß√£o**: `/src/components/ui/`

Biblioteca completa de componentes baseada em Radix UI:
- ‚úÖ Button, Input, Select, Checkbox
- ‚úÖ Dialog, AlertDialog, Sheet
- ‚úÖ Card, Tabs, Accordion
- ‚úÖ Toast, Popover, Dropdown
- ‚úÖ Calendar, DatePicker
- ‚úÖ Charts (Recharts integration)
- ‚úÖ E mais 60+ componentes

---

## üîê Autentica√ß√£o e Seguran√ßa

### Sistema de Autentica√ß√£o

**Provedor**: Supabase Auth

**M√©todos Suportados**:
- ‚úÖ Email/Senha
- ‚úÖ Magic Link (email)
- ‚ö†Ô∏è OAuth (preparado, n√£o configurado)

### Fluxo de Autentica√ß√£o

```typescript
// 1. Login
const { data, error } = await supabase.auth.signInWithPassword({
  email: 'user@example.com',
  password: 'password123'
});

// 2. Cadastro
const { data, error } = await supabase.auth.signUp({
  email: 'user@example.com',
  password: 'password123',
  options: {
    data: { full_name: 'John Doe' }
  }
});

// 3. Logout
await supabase.auth.signOut();

// 4. Verificar sess√£o
const { data: { session } } = await supabase.auth.getSession();

// 5. Listener de mudan√ßas
supabase.auth.onAuthStateChange((event, session) => {
  if (event === 'SIGNED_IN') {
    // Usu√°rio logou
  }
});
```

### Row Level Security (RLS)

Todas as tabelas possuem RLS habilitado:

```sql
-- Pol√≠tica: Usu√°rios veem apenas seus dados
CREATE POLICY "user_isolation" ON transactions
  FOR ALL
  USING (auth.uid() = user_id);

-- Pol√≠tica: Admins veem tudo
CREATE POLICY "admin_access" ON transactions
  FOR ALL
  USING (is_admin());

-- Pol√≠tica: Planos p√∫blicos s√£o vis√≠veis
CREATE POLICY "public_plans" ON subscription_plans
  FOR SELECT
  USING (is_active = true);
```

### Fun√ß√£o `is_admin()`

```sql
CREATE OR REPLACE FUNCTION is_admin()
RETURNS BOOLEAN AS $$
BEGIN
  RETURN EXISTS (
    SELECT 1 
    FROM admin_users 
    WHERE user_id = auth.uid() 
    AND is_active = true
  );
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;
```

### Prote√ß√£o de Rotas

**Frontend**:
```typescript
// App.tsx
<Route
  path="/sistema"
  element={
    isAuthenticated ? (
      <SubscriptionGuard>
        <AppLayout />
      </SubscriptionGuard>
    ) : (
      <Navigate to="/login" />
    )
  }
/>
```

**Backend (RLS)**:
```sql
-- Apenas usu√°rios autenticados
USING (auth.uid() IS NOT NULL)

-- Apenas admins
USING (is_admin())

-- Apenas donos dos dados
USING (auth.uid() = user_id)
```

### Seguran√ßa de Edge Functions

```typescript
// Validar Authorization header
const authHeader = req.headers.get('Authorization');
if (!authHeader) {
  return new Response('Unauthorized', { status: 401 });
}

// Validar webhook token
const webhookToken = req.headers.get('X-Webhook-Token');
if (webhookToken !== Deno.env.get('ASAAS_WEBHOOK_TOKEN')) {
  return new Response('Invalid token', { status: 403 });
}
```

### Vari√°veis de Ambiente Sens√≠veis

```bash
# Supabase
VITE_SUPABASE_URL=https://xxx.supabase.co
VITE_SUPABASE_ANON_KEY=eyJxxx...

# Asaas (apenas Edge Functions)
ASAAS_API_KEY=xxx
ASAAS_SANDBOX=true
ASAAS_WEBHOOK_TOKEN=xxx
```

**‚ö†Ô∏è IMPORTANTE**:
- Nunca exponha `ASAAS_API_KEY` no frontend
- Use `VITE_` apenas para vari√°veis p√∫blicas
- Edge Functions usam secrets do Supabase

---

## üöÄ Configura√ß√£o e Deploy

### Pr√©-requisitos

- Node.js 18+ e npm/yarn/bun
- Conta no Supabase
- Conta no Asaas (para pagamentos)
- Conta no Netlify/Vercel (opcional para deploy)

### Instala√ß√£o Local

```bash
# 1. Clonar reposit√≥rio
git clone <repo-url>
cd SistemaOrbi-main

# 2. Instalar depend√™ncias
npm install
# ou
bun install

# 3. Configurar vari√°veis de ambiente
cp .env.example .env

# Editar .env com suas credenciais:
VITE_SUPABASE_URL=https://seu-projeto.supabase.co
VITE_SUPABASE_ANON_KEY=sua-key-aqui

# 4. Rodar em desenvolvimento
npm run dev
# Acessar: http://localhost:8080
```

### Configura√ß√£o do Supabase

#### 1. Criar Projeto

```bash
# Instalar CLI
npm install -g supabase

# Login
npx supabase login

# Inicializar (se necess√°rio)
npx supabase init
```

#### 2. Aplicar Migrations

```bash
# Push migrations para o Supabase
npx supabase db push

# Ou aplicar manualmente no Dashboard SQL Editor
```

#### 3. Deploy de Edge Functions

```bash
# Deploy todas as functions
npx supabase functions deploy asaas-create-customer
npx supabase functions deploy asaas-create-payment
npx supabase functions deploy asaas-webhook-handler
npx supabase functions deploy classify-transactions
npx supabase functions deploy get-company-logo
npx supabase functions deploy search-logo
```

#### 4. Configurar Secrets

```bash
npx supabase secrets set ASAAS_API_KEY=sua-key
npx supabase secrets set ASAAS_SANDBOX=true
npx supabase secrets set ASAAS_WEBHOOK_TOKEN=seu-token
```

### Configura√ß√£o do Asaas

#### 1. Criar Conta

- Sandbox: https://sandbox.asaas.com
- Produ√ß√£o: https://www.asaas.com

#### 2. Obter API Key

- Dashboard ‚Üí Configura√ß√µes ‚Üí API
- Copiar token

#### 3. Configurar Webhooks

- Dashboard ‚Üí Webhooks
- URL: `https://seu-projeto.supabase.co/functions/v1/asaas-webhook-handler`
- Eventos:
  - ‚úÖ PAYMENT_CREATED
  - ‚úÖ PAYMENT_CONFIRMED
  - ‚úÖ PAYMENT_RECEIVED
  - ‚úÖ PAYMENT_OVERDUE
  - ‚úÖ PAYMENT_REFUNDED

### Criar Primeiro Admin

```sql
-- 1. Encontrar seu user_id
SELECT id, email FROM auth.users;

-- 2. Criar admin
INSERT INTO public.admin_users (user_id, role, is_active)
VALUES ('seu-user-id-aqui', 'super_admin', true);
```

### Criar Planos Iniciais

Execute os inserts ou use o painel `/admin/plans`:

```sql
-- Plano Free
INSERT INTO subscription_plans (name, slug, monthly_price, annual_price, features, limits)
VALUES (
  'Free',
  'free',
  0.00,
  0.00,
  ARRAY['basic_dashboard', 'manual_categorization'],
  '{"max_accounts": 2, "max_transactions_per_month": 100}'::jsonb
);

-- Ver documenta√ß√£o SAAS_SETUP.md para planos completos
```

### Build para Produ√ß√£o

```bash
# Build otimizado
npm run build

# Testar build localmente
npm run preview
```

### Deploy no Netlify

#### Via CLI:

```bash
# Instalar Netlify CLI
npm install -g netlify-cli

# Login
netlify login

# Deploy
netlify deploy --prod
```

#### Via Dashboard:

1. Conectar reposit√≥rio GitHub
2. Build command: `npm run build`
3. Publish directory: `dist`
4. Environment variables:
   - `VITE_SUPABASE_URL`
   - `VITE_SUPABASE_ANON_KEY`

### Deploy no Vercel

```bash
# Instalar Vercel CLI
npm install -g vercel

# Login
vercel login

# Deploy
vercel --prod
```

### Configura√ß√£o de Produ√ß√£o

**Checklist**:

- [ ] Alterar `ASAAS_SANDBOX=false`
- [ ] Usar API Key de produ√ß√£o do Asaas
- [ ] Configurar webhook URL de produ√ß√£o
- [ ] Testar fluxo de pagamento com valores reais
- [ ] Habilitar HTTPS
- [ ] Configurar dom√≠nio customizado
- [ ] Configurar backups do banco
- [ ] Habilitar logs de auditoria
- [ ] Configurar monitoramento de erros

### Scripts Dispon√≠veis

```json
{
  "dev": "vite",                        // Dev server
  "dev:local": "./scripts/start-dev.sh", // Dev com Supabase local
  "build": "vite build",                 // Build produ√ß√£o
  "build:dev": "vite build --mode development", // Build dev
  "lint": "eslint .",                   // Linter
  "preview": "vite preview"             // Preview do build
}
```

---

## üìÅ Estrutura de Pastas

```
SistemaOrbi-main/
‚îú‚îÄ‚îÄ docs/                           # Documenta√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ ASAAS_SETUP_COMMANDS.md
‚îÇ   ‚îú‚îÄ‚îÄ DEPLOY_PRODUCAO.md
‚îÇ   ‚îú‚îÄ‚îÄ INTEGRACAO_ASAAS.md
‚îÇ   ‚îú‚îÄ‚îÄ MOBILE_REFACTOR.md
‚îÇ   ‚îú‚îÄ‚îÄ SAAS_SETUP.md
‚îÇ   ‚îî‚îÄ‚îÄ DOCUMENTACAO_SISTEMA_ORBI.md
‚îÇ
‚îú‚îÄ‚îÄ public/                         # Arquivos est√°ticos
‚îÇ   ‚îú‚îÄ‚îÄ favicon.ico
‚îÇ   ‚îú‚îÄ‚îÄ robots.txt
‚îÇ   ‚îî‚îÄ‚îÄ _redirects                  # Netlify redirects
‚îÇ
‚îú‚îÄ‚îÄ scripts/                        # Scripts de automa√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ dev-setup.sh
‚îÇ   ‚îú‚îÄ‚îÄ start-dev.sh
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ
‚îú‚îÄ‚îÄ src/                            # C√≥digo-fonte
‚îÇ   ‚îú‚îÄ‚îÄ admin/                      # Painel Administrativo
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/             # Componentes admin
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AddAdminDialog.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AdminAuthForm.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AdminHeader.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AdminSidebar.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PlanDialog.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ UserDetailDialog.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ layouts/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ AdminLayout.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ pages/                  # P√°ginas admin
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ AdminDashboard.tsx
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ AdminManagement.tsx
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ BugReportsManagement.tsx
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ PlanManagement.tsx
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ SubscriptionManagement.tsx
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ UserManagement.tsx
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ assets/                     # Assets est√°ticos
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ orbi-logo_dark.png
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ orbi-logo_white.png
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pix-dark.svg
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ pix-white.svg
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ components/                 # Componentes React
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth/                   # Autentica√ß√£o
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ AuthForm.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ bugs/                   # Relat√≥rios de bugs
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ReportBugDialog.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dashboard/              # Dashboard
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Dashboard.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ SubscriptionChart.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ extrato-uploader/       # Upload de CSV
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ BankDictionary.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ BatchClassifier.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ConfirmationDialog.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CSVParser.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DescriptionNormalizer.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ EnhancedCSVParser.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ExtratoUploader.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ IntelligentCache.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ IntelligentTransactionClassifier.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ MerchantCache.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ TransactionMLClassifier.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ guards/                 # Route guards
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ FeatureGuard.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ SubscriptionGuard.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ navigation/             # Navega√ß√£o
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AppHeader.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AppSidebar.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ SearchPopover.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ payment/                # Pagamentos
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ PaymentDialog.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ people/                 # Gest√£o de pessoas
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ PersonDetail.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ui/                     # Componentes UI (shadcn)
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ [64 componentes]
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ hooks/                      # Hooks customizados
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ use-accounts.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ use-admin-auth.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ use-auth.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ use-bug-reports.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ use-card-transactions.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ use-card-usage.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ use-categories.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ use-credit-cards.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ use-debts.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ use-feature.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ use-installments.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ use-learned-patterns.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ use-mobile.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ use-monthly-transactions.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ use-notes.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ use-payment.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ use-people.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ use-person-transactions.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ use-series.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ use-status-sync.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ use-subscription.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ use-subscriptions.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ use-theme.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ use-toast.ts
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ integrations/               # Integra√ß√µes externas
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ supabase/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ client.ts           # Cliente Supabase
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ types.ts            # Types do banco
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ layouts/                    # Layouts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ AppLayout.tsx
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ lib/                        # Bibliotecas e utils
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ features/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ utils.ts
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ pages/                      # P√°ginas principais
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Accounts.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Cards.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CardStatements.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Categories.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Index.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ MonthlyStatement.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ MyAI.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Notes.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ NotFound.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ People.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Pricing.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Settings.tsx
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ App.tsx                     # Componente principal
‚îÇ   ‚îú‚îÄ‚îÄ main.tsx                    # Entry point
‚îÇ   ‚îú‚îÄ‚îÄ index.css                   # Estilos globais
‚îÇ   ‚îî‚îÄ‚îÄ vite-env.d.ts               # Types Vite
‚îÇ
‚îú‚îÄ‚îÄ supabase/                       # Configura√ß√£o Supabase
‚îÇ   ‚îú‚îÄ‚îÄ config.toml                 # Configura√ß√£o local
‚îÇ   ‚îú‚îÄ‚îÄ functions/                  # Edge Functions
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ _shared/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ cors.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ asaas-create-customer/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ asaas-create-payment/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ asaas-webhook-handler/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ classify-transactions/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ get-company-logo/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ search-logo/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îú‚îÄ‚îÄ migrations/                 # Migrations SQL (87 arquivos)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ [migrations SQL]
‚îÇ   ‚îî‚îÄ‚îÄ seed/                       # Seeds iniciais
‚îÇ       ‚îú‚îÄ‚îÄ 01_initial_data.sql
‚îÇ       ‚îî‚îÄ‚îÄ 02_initial_categories.sql
‚îÇ
‚îú‚îÄ‚îÄ .env                            # Vari√°veis de ambiente (local)
‚îú‚îÄ‚îÄ .gitignore                      # Arquivos ignorados
‚îú‚îÄ‚îÄ components.json                 # Config shadcn/ui
‚îú‚îÄ‚îÄ eslint.config.js                # Config ESLint
‚îú‚îÄ‚îÄ index.html                      # HTML principal
‚îú‚îÄ‚îÄ netlify.toml                    # Config Netlify
‚îú‚îÄ‚îÄ nginx.conf                      # Config Nginx
‚îú‚îÄ‚îÄ package.json                    # Depend√™ncias NPM
‚îú‚îÄ‚îÄ postcss.config.js               # Config PostCSS
‚îú‚îÄ‚îÄ README.md                       # README
‚îú‚îÄ‚îÄ tailwind.config.ts              # Config Tailwind
‚îú‚îÄ‚îÄ tsconfig.json                   # Config TypeScript
‚îú‚îÄ‚îÄ vercel.json                     # Config Vercel
‚îî‚îÄ‚îÄ vite.config.ts                  # Config Vite
```

---

## üìä Estat√≠sticas do Projeto

### Tamanho do C√≥digo

- **Total de arquivos**: ~300+ arquivos
- **Linhas de c√≥digo**: ~50.000+ linhas
- **Migrations SQL**: 87 arquivos
- **Componentes React**: 100+ componentes
- **Hooks customizados**: 24 hooks
- **Edge Functions**: 6 functions
- **P√°ginas**: 12 p√°ginas principais + 6 p√°ginas admin

### Depend√™ncias

- **Frontend**: 35 depend√™ncias
- **Dev**: 13 dev dependencies
- **Total**: 48 packages

---

## üîÑ Fluxos de Uso Principais

### 1. Novo Usu√°rio

```
1. Acessa /pricing
2. Clica em "Come√ßar Gr√°tis"
3. Cadastra-se (email/senha)
4. Recebe plano Free automaticamente
5. Redirecionado para /sistema
6. V√™ dashboard inicial
7. Adiciona primeira conta
8. Adiciona primeira transa√ß√£o
```

### 2. Upgrade de Plano

```
1. Usu√°rio Free acessa /pricing
2. Seleciona plano Pro
3. Escolhe ciclo (mensal/anual)
4. Sistema gera cobran√ßa via Asaas
5. Exibe dados de pagamento (PIX/Boleto)
6. Usu√°rio paga
7. Asaas envia webhook
8. Sistema ativa plano Pro
9. Usu√°rio recebe acesso √†s features Pro
```

### 3. Upload de Extrato

```
1. Usu√°rio acessa /sistema/statement
2. Clica em "Upload CSV"
3. Seleciona arquivo CSV do banco
4. Parser detecta formato automaticamente
5. Normaliza descri√ß√µes
6. ML classifica transa√ß√µes
7. Mostra preview com sugest√µes
8. Usu√°rio confirma ou ajusta
9. Transa√ß√µes s√£o salvas
10. ML aprende com confirma√ß√µes
```

### 4. Administrador Gerenciando Usu√°rios

```
1. Admin acessa /admin
2. Faz login com credenciais admin
3. Acessa /admin/users
4. Visualiza lista de usu√°rios
5. Clica em usu√°rio espec√≠fico
6. V√™ detalhes e hist√≥rico
7. Pode alterar plano
8. Pode desativar usu√°rio
9. A√ß√µes s√£o registradas em audit_logs
```

---

## üêõ Troubleshooting Comum

### Erro: "Missing Supabase environment variables"

**Solu√ß√£o**: Verifique se `.env` existe e cont√©m:
```env
VITE_SUPABASE_URL=...
VITE_SUPABASE_ANON_KEY=...
```

### Erro: "User not authorized" ao acessar admin

**Solu√ß√£o**: Crie registro em `admin_users`:
```sql
INSERT INTO admin_users (user_id, role, is_active)
VALUES ('seu-user-id', 'super_admin', true);
```

### Transa√ß√µes n√£o aparecem

**Solu√ß√£o**: 
1. Verificar se RLS est√° habilitado
2. Verificar se `user_id` est√° correto
3. Verificar se sess√£o est√° ativa

### ML n√£o est√° classificando bem

**Solu√ß√£o**:
1. Treinar mais o modelo confirmando classifica√ß√µes
2. Adicionar mais padr√µes em `keyword_patterns`
3. Verificar dicion√°rio de comerciantes

### Edge Function retorna 500

**Solu√ß√£o**:
1. Ver logs: `npx supabase functions logs nome-da-function`
2. Verificar secrets configurados
3. Testar payload de entrada

---

## üìà Roadmap Futuro

### Features Planejadas

- [ ] App Mobile (React Native)
- [ ] API REST p√∫blica
- [ ] Integra√ß√£o com Open Banking
- [ ] Importa√ß√£o autom√°tica de bancos
- [ ] Metas financeiras
- [ ] Relat√≥rios personalizados
- [ ] Exporta√ß√£o para Excel
- [ ] Dashboards customiz√°veis
- [ ] Compartilhamento de contas (fam√≠lia)
- [ ] M√∫ltiplas moedas
- [ ] Integra√ß√µes: Nubank, PicPay, etc
- [ ] Assistente AI conversacional
- [ ] Previs√µes financeiras com ML
- [ ] Alertas inteligentes
- [ ] Gamifica√ß√£o

---

## üìû Suporte e Contato

Para d√∫vidas, bugs ou sugest√µes:

- **Email**: suporte@orbi.com.br (exemplo)
- **GitHub Issues**: [Link do reposit√≥rio]
- **Documenta√ß√£o**: Este arquivo e docs/

---

## üìù Licen√ßa

¬© 2025 Sistema Orbi. Todos os direitos reservados.

---

**√öltima atualiza√ß√£o**: 19 de Outubro de 2025

**Vers√£o da Documenta√ß√£o**: 1.0.0

---

## üéì Gloss√°rio

| Termo | Defini√ß√£o |
|-------|-----------|
| **RLS** | Row Level Security - Seguran√ßa a n√≠vel de linha no PostgreSQL |
| **Edge Function** | Fun√ß√£o serverless que roda na borda (Deno runtime) |
| **SaaS** | Software as a Service - Software como servi√ßo |
| **ML** | Machine Learning - Aprendizado de m√°quina |
| **Webhook** | Callback HTTP autom√°tico quando evento ocorre |
| **Multi-tenant** | Arquitetura onde m√∫ltiplos clientes compartilham infraestrutura |
| **shadcn/ui** | Cole√ß√£o de componentes React reutiliz√°veis |
| **Supabase** | Backend-as-a-Service baseado em PostgreSQL |
| **TanStack Query** | Biblioteca de gerenciamento de estado ass√≠ncrono |
| **Vite** | Build tool moderna e r√°pida para frontend |

---

## üôè Agradecimentos

Este sistema foi constru√≠do com tecnologias open-source incr√≠veis:

- React Team
- Supabase Team
- shadcn (shadcn/ui)
- Vercel (Next Themes)
- TanStack (React Query)
- Radix UI Team
- E toda a comunidade open-source

---

**Fim da Documenta√ß√£o**

Para qualquer atualiza√ß√£o nesta documenta√ß√£o, edite o arquivo:  
`/docs/DOCUMENTACAO_SISTEMA_ORBI.md`

